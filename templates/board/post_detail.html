{% extends 'base.html' %}
<head>
  {% load static %}
  {% block extrahead %}
  <link rel="stylesheet" href="{% static 'post_detail.css' %}">
  {% endblock %}
</head>
{% block content %}
<div class="container">
    <div class="sidebar">
        {% if post.category == "11" or post.category == "12" or post.category == "13" or post.category == "14" %}
        <div class="sidebar-menu active"><a href="{% url 'board:posts' 11 %}">질문과 답변</a></div>
        {% else %}
        <div class="sidebar-menu"><a href="{% url 'board:posts' 11 %}">질문과 답변</a></div>
        {% endif %}
        {% if post.category == "31" or post.category == "32" or post.category == "33" or post.category == "34" %}
        <div class="sidebar-menu active"><a href="{% url 'board:posts' 31 %}">자료게시판</a></div>
        {% else %}
        <div class="sidebar-menu"><a href="{% url 'board:posts' 31 %}">자료게시판</a></div>
        {% endif %}
        {% if post.category == "20" %}
        <div class="sidebar-menu active"><a href="{% url 'board:posts' 20 %}">자유게시판</a></div>
        {% else %}
        <div class="sidebar-menu"><a href="{% url 'board:posts' 20 %}">자유게시판</a></div>
        {% endif %}
        <div class="sidebar-menu"><a>내가 쓴 게시글</a></div>
        <div class="sidebar-menu"><a>글쓰기<img src="/static/img/writeicon.png" alt=""></a></div>
    </div>
    <div class="mainarea">
        <div class="content">
            <div class="categoryBox">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" viewBox="0 0 18 17" fill="none">
                    <path d="M9 0.625L0 7.375H2.25V16.375H6.75V11.875H11.25V16.375H15.75V7.3075L18 7.375L9 0.625Z" fill="#A8AAAE"/>
                </svg>
                {% if post.category == "11" or post.category == "12" or post.category == "13" or post.category == "14" %}
                <a href="">질문과 답변</a>&nbsp;-
                {% elif post.category == "20" %}
                <a href="">자유게시판</a>&nbsp;
                {% elif post.category == "31" or post.category == "32" or post.category == "33" or post.category == "34" %}
                <a href="">자료게시판</a>&nbsp;-
                {% elif post.category == "40" %}
                <a href="">공지사항</a>&nbsp;2020-08-16
                {% endif %}
                {% if post.category == "11" or post.category == "31" %}
                <a href="">국어</a>
                {% elif post.category == "12" or post.category == "32" %}
                <a href="">수학</a>
                {% elif post.category == "13" or post.category == "33" %}
                <a href="">영어</a>
                {% elif post.category == "14" or post.category == "34" %}
                <a href="">탐구</a>
                {% endif %}
            </div>
            <div class="subjectBox">
                {{ post.subject }}
            </div>
            <div class="authorBox">
                <div class="authorInfo">
                    <img src="/static/img/userImage.png" alt="">
                    <div class="nameandDate">
                        <a href="" class="authorName">{{ post.user }}</a>
                        <div class="date">{{ post.create_date|date:"Y-m-d H:i:s" }}</div>
                    </div>
                </div>
                <div class="look">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="19" viewBox="0 0 25 19" fill="none">
                        <path d="M12.5938 0.5C4.6875 0.5 0 9.5 0 9.5C0 9.5 4.6875 18.5 12.5938 18.5C20.3125 18.5 25 9.5 25 9.5C25 9.5 20.3125 0.5 12.5938 0.5ZM12.5 3.5C15.9688 3.5 18.75 6.2 18.75 9.5C18.75 12.83 15.9688 15.5 12.5 15.5C9.0625 15.5 6.25 12.83 6.25 9.5C6.25 6.2 9.0625 3.5 12.5 3.5ZM12.5 6.5C10.7812 6.5 9.375 7.85 9.375 9.5C9.375 11.15 10.7812 12.5 12.5 12.5C14.2188 12.5 15.625 11.15 15.625 9.5C15.625 9.2 15.5 8.93 15.4375 8.66C15.1875 9.14 14.6875 9.5 14.0625 9.5C13.1875 9.5 12.5 8.84 12.5 8C12.5 7.4 12.875 6.92 13.375 6.68C13.0938 6.59 12.8125 6.5 12.5 6.5Z" fill="#DFE5EE"/>
                    </svg>
                    <div class="lookNumber">999</div>
                </div>
            </div>
            <div class="contentBox">
                <p>{{ post.content|safe }}</p>
            </div>
            <div class="buttonBox">
                {% if isVoted %}
                <button class="postButton voted">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="#4A5BAB">
                        <path opacity="1" d="M16.6029 0.00987574C15.8971 0.0841332 15.2286 0.566807 14.8571 1.27225C14.3743 2.2376 10.8086 9.40345 10.1029 10.1089C9.39714 10.8143 8.46857 11.1485 7.42857 11.1485V26H20.4286C21.2086 26 21.8771 25.5173 22.1743 24.849C22.1743 24.849 26 14.0445 26 13.0049C26 11.9653 25.1829 11.1485 24.1429 11.1485H18.5714C17.5314 11.1485 16.7143 10.2203 16.7143 9.29206C16.7143 8.36384 18.1629 3.42572 18.46 2.46037C18.7571 1.49503 18.2743 0.455421 17.3086 0.121262C17.0486 0.0470045 16.8629 -0.027253 16.6029 0.00987574ZM0 11.1485V26H3.71429V11.1485H0Z" fill="#4A5BAB"/>
                    </svg>
                    추천 {{ post.voter.count }}
                </button>
                {% else %}
                <button class="postButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="#4D4E52">
                        <path opacity="0.3" d="M16.6029 0.00987574C15.8971 0.0841332 15.2286 0.566807 14.8571 1.27225C14.3743 2.2376 10.8086 9.40345 10.1029 10.1089C9.39714 10.8143 8.46857 11.1485 7.42857 11.1485V26H20.4286C21.2086 26 21.8771 25.5173 22.1743 24.849C22.1743 24.849 26 14.0445 26 13.0049C26 11.9653 25.1829 11.1485 24.1429 11.1485H18.5714C17.5314 11.1485 16.7143 10.2203 16.7143 9.29206C16.7143 8.36384 18.1629 3.42572 18.46 2.46037C18.7571 1.49503 18.2743 0.455421 17.3086 0.121262C17.0486 0.0470045 16.8629 -0.027253 16.6029 0.00987574ZM0 11.1485V26H3.71429V11.1485H0Z" fill="#4D4E52"/>
                    </svg>
                    추천 {{ post.voter.count }}
                </button>
                {% endif %}
                <button class="postButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="23" height="26" viewBox="0 0 23 26" fill="none">
                        <g opacity="0.3">
                            <path d="M16.9041 0.5C16.3853 0.531428 15.8665 0.594285 15.3766 0.782855C14.5984 1.09714 13.849 1.56856 13.2149 2.25998C13.0325 2.3861 12.8784 2.55532 12.764 2.75514C12.6496 2.95495 12.5779 3.18025 12.5541 3.41437C12.5304 3.64848 12.5552 3.88543 12.6267 4.10768C12.6983 4.32993 12.8147 4.5318 12.9675 4.69835C13.1202 4.86491 13.3053 4.99189 13.5092 5.06991C13.713 5.14793 13.9303 5.17498 14.145 5.14908C14.3597 5.12317 14.5663 5.04497 14.7495 4.92025C14.9328 4.79552 15.088 4.62748 15.2036 4.42854C15.5207 4.08283 15.8954 3.89426 16.2989 3.73711C17.3076 3.35998 18.547 3.51712 19.354 4.42854C20.4781 5.65424 20.4781 7.69708 19.354 8.95421L15.0307 13.6685C13.7625 15.0513 12.7249 15.177 11.9756 15.1456C11.2262 15.1142 10.7939 14.737 10.7939 14.737C10.6273 14.6338 10.4438 14.5674 10.2537 14.5416C10.0636 14.5158 9.87075 14.531 9.68608 14.5865C9.50141 14.6419 9.32857 14.7365 9.17741 14.8648C9.02626 14.9931 8.89976 15.1526 8.80514 15.3342C8.71051 15.5158 8.64962 15.7159 8.62593 15.9232C8.60224 16.1304 8.61622 16.3407 8.66707 16.5421C8.71792 16.7435 8.80465 16.9319 8.9223 17.0968C9.03995 17.2616 9.18622 17.3995 9.35276 17.5027C9.35276 17.5027 10.3327 18.1941 11.7738 18.2884C13.2149 18.3827 15.2325 17.7856 16.9906 15.837L21.3139 11.1228C23.562 8.67136 23.562 4.71139 21.3139 2.29141C20.5069 1.41142 19.5558 0.87714 18.5182 0.625713C17.9994 0.5 17.4229 0.5 16.9041 0.531428V0.5ZM11.1397 7.75994C9.69862 7.69708 7.7099 8.23136 6.0094 10.1171L1.68609 14.8313C-0.56203 17.2827 -0.56203 21.2427 1.68609 23.6627C3.30013 25.4226 5.60589 25.9255 7.62343 25.1398C8.40163 24.8255 9.151 24.3541 9.78509 23.6627C9.96753 23.5365 10.1216 23.3673 10.236 23.1675C10.3504 22.9677 10.4221 22.7424 10.4459 22.5083C10.4696 22.2742 10.4448 22.0372 10.3733 21.815C10.3017 21.5927 10.1853 21.3908 10.0325 21.2243C9.87979 21.0577 9.69466 20.9307 9.49084 20.8527C9.28702 20.7747 9.06972 20.7477 8.85502 20.7736C8.64032 20.7995 8.4337 20.8777 8.25045 21.0024C8.06721 21.1271 7.91202 21.2952 7.79637 21.4941C7.47932 21.8398 7.10464 22.0284 6.70113 22.1855C5.69236 22.5627 4.45301 22.4055 3.64599 21.4941C2.52193 20.2684 2.52193 18.2256 3.64599 16.9684L7.9693 12.2542C9.12218 10.9971 10.131 10.8399 10.938 10.8713C11.745 10.9028 12.2926 11.1542 12.2926 11.1542C12.4615 11.2923 12.6561 11.3883 12.8627 11.4353C13.0694 11.4823 13.2829 11.4793 13.4884 11.4264C13.6938 11.3736 13.8861 11.2721 14.0516 11.1293C14.2171 10.9864 14.3518 10.8057 14.4462 10.5998C14.5406 10.394 14.5924 10.168 14.5979 9.93789C14.6034 9.7078 14.5624 9.4792 14.478 9.26826C14.3935 9.05733 14.2676 8.86919 14.1091 8.71717C13.9506 8.56515 13.7634 8.45295 13.5608 8.3885C13.5608 8.3885 12.5808 7.75994 11.1397 7.69708V7.75994Z" fill="#4D4E52"/>
                        </g>
                    </svg>
                    공유하기
                </button>
            </div>
            <div class="fileBox">
                원본 첨부파일
            </div>
            {% if isAuthor %}
            <div class="modifyDeleteBox">
                <button class="modifyDeleteButton">수정하기</button>
                <button class="modifyDeleteButton">삭제하기</button>
            </div>
            {% endif %}
            <div class="commentStartBox">
                <div class="commentNum">총 {{ post.comment.count }}개의 답변이 있습니다.</div>
                <a id="toPosts" href="">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="15" viewBox="0 0 18 15" fill="none">
                        <path d="M0 0V2.15208H18V0H0ZM0 6.39168V8.54376H18V6.39168H0ZM0 12.8479V15H18V12.8479H0Z" fill="#4D4E52"/>
                    </svg>
                    목록으로
                </a>
            </div>
            <div class="commentWriteBox">
                <img src="/static/img/userImage.png" alt="">
                <form action="{% url 'board:comment_create' post.id %}" class="commentForm" method="post">
                    {% csrf_token %}
                    {{ commentForm.media }}
                    {{ commentForm.content }}
                    <button type="submit">작성</button>
                </form>
            </div>
            {% for comment in post.comment.all %}
            {% if not comment.parent_comment %}
            <div class="commentBox">
                <div class="maincomment">
                    <div class="commentTitle">
                        <img src="/static/img/userImage.png" alt="">
                        <div class="nameandDate_comment">
                            <a href="" class="authorName_comment">{{comment.user}}</a>
                            <div class="date_comment">{{ comment.create_date|date:"Y-m-d H:i:s" }}</div>
                        </div>
                        <a class="recommend_comment" href="javascript:void(0);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none">
                                <path d="M7.152 0.504558C6.848 0.538831 6.56 0.761603 6.4 1.08719C6.192 1.53274 4.656 4.84005 4.352 5.16564C4.048 5.49123 3.648 5.64546 3.2 5.64546V12.5H8.8C9.136 12.5 9.424 12.2772 9.552 11.9688C9.552 11.9688 11.2 6.9821 11.2 6.50228C11.2 6.02246 10.848 5.64546 10.4 5.64546H8C7.552 5.64546 7.2 5.21705 7.2 4.78864C7.2 4.36024 7.824 2.0811 7.952 1.63556C8.08 1.19001 7.872 0.710194 7.456 0.555967C7.344 0.521694 7.264 0.487422 7.152 0.504558ZM0 5.64546V12.5H1.6V5.64546H0Z" fill="#4A5BAB"/>
                            </svg>
                            {{comment.voter.count}}
                        </a>
                        {% if user.is_authenticated %}
                        <a href="javascript:void(0);" class="comment_link replyFormLink">답글</a>
                        {% endif %}
                        {% if user == comment.user %}
                        <a href="" class="comment_link">수정</a>
                        <a href="" class="comment_link">삭제</a>
                        {% endif %}
                    </div>
                    <div class="commentcontent">
                        {{ comment.content|safe }}
                    </div>
                    <form class="commentForm Reply hidden" method="post" style="margin-left: 32px; margin-top: 20px;">
                        {% csrf_token %}
                        {{ commentForm.media }}
                        {{ commentForm.content }}
                        <button type="submit">작성</button>
                    </form>
                </div>
                {% for reply in comment.child.all %}
                <div class="subcomment">
                    <div class="commentTitle">
                        <img src="/static/img/userImage.png" alt="">
                        <div class="nameandDate_comment">
                            <a href="" class="authorName_comment">{{reply.user}}</a>
                            <div class="date_comment">{{ reply.create_date|date:"Y-m-d H:i:s" }}</div>
                        </div>
                        <a class="recommend_comment" href="javascript:void(0);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none">
                                <path d="M7.152 0.504558C6.848 0.538831 6.56 0.761603 6.4 1.08719C6.192 1.53274 4.656 4.84005 4.352 5.16564C4.048 5.49123 3.648 5.64546 3.2 5.64546V12.5H8.8C9.136 12.5 9.424 12.2772 9.552 11.9688C9.552 11.9688 11.2 6.9821 11.2 6.50228C11.2 6.02246 10.848 5.64546 10.4 5.64546H8C7.552 5.64546 7.2 5.21705 7.2 4.78864C7.2 4.36024 7.824 2.0811 7.952 1.63556C8.08 1.19001 7.872 0.710194 7.456 0.555967C7.344 0.521694 7.264 0.487422 7.152 0.504558ZM0 5.64546V12.5H1.6V5.64546H0Z" fill="#4A5BAB"/>
                            </svg>
                            {{reply.voter.count}}
                        </a>
                        {% if user.is_authenticated %}
                        <a href="javascript:void(0);" class="comment_link replyFormLink">답글</a>
                        {% endif %}
                        {% if user == reply.user %}
                        <a href="" class="comment_link">수정</a>
                        <a href="" class="comment_link">삭제</a>
                        {% endif %}
                    </div>
                    <div class="commentcontent">
                        {{ reply.content|safe }}
                    </div>
                    <form class="commentForm Reply hidden" method="post" style="margin-left: 32px; margin-top: 20px;">
                        {% csrf_token %}
                        {{ commentForm.media }}
                        {{ commentForm.content }}
                        <button type="submit">작성</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
<script>
    var textarea = document.querySelectorAll('.commentForm > textarea');

    textarea[0].addEventListener('input',() => {
        textarea[0].style.height = 'auto';
        textarea[0].style.height = textarea[0].scrollHeight + 'px';
    })
</script>
<!-- hidden form 설정 -->
<script>
    const toggleLinks = document.querySelectorAll(".replyFormLink");
    const toggleForms = document.querySelectorAll(".Reply");

    toggleLinks.forEach((link, index) => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            toggleForms[index].classList.toggle('hidden');
        });
    });
</script>
{% endblock %}